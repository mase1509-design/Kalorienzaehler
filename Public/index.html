<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalorienzähler – Wochenansicht</title>

  <style>
    body{font-family:system-ui,Arial,sans-serif;background:#0e1421;color:#f0f4f8;margin:0;padding:24px}
    h1,h2{margin:0 0 8px}
    section{background:#182235;border-radius:12px;padding:16px;margin-bottom:20px;box-shadow:0 4px 18px rgba(0,0,0,0.3)}
    input,select,button{padding:8px 10px;border-radius:6px;border:none;font-size:14px}
    input,select{background:#0f172a;color:#fff}
    button{cursor:pointer}
    .btn{background:#3b82f6;color:#fff}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.05)}
    .muted{color:#9ca3af}
    .total{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    progress{width:100%;height:18px;border-radius:6px;overflow:hidden}
    progress::-webkit-progress-bar{background:#1f2937}
    progress::-webkit-progress-value{background:#3b82f6}
    .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  </style>
</head>
<body>
  <h1>Kalorienzähler</h1>

  <section>
    <h2>Neuer Eintrag</h2>
    <div class="grid">
      <input id="food" placeholder="Lebensmittel">
      <input id="cal" type="number" min="0" step="0.1" placeholder="Kalorien (kcal)">
      <select id="meal">
        <option>Frühstück</option><option>Mittagessen</option><option>Abendessen</option><option>Snack</option>
      </select>
      <button id="add" class="btn">Hinzufügen</button>
    </div>
  </section>

  <section>
    <h2>Heute <span id="today"></span></h2>
    <table id="list"><thead><tr><th>Lebensmittel</th><th>Mahlzeit</th><th>Kcal</th></tr></thead><tbody></tbody></table>
    <div class="total">
      <div>Gesamt heute: <b id="sum">0</b> / <span id="goal">2300</span> kcal</div>
    </div>
    <progress id="progress" max="2300" value="0"></progress>
  </section>

  <section>
    <h2>Woche</h2>
    <div class="grid">
      <div>
        <b>Bisher verbraucht:</b><br>
        <span id="weekUsed">0</span> kcal
      </div>
      <div>
        <b>Gesamt erlaubt (7 × 2300 kcal):</b><br>
        <span id="weekLimit">16100</span> kcal
      </div>
      <div>
        <b>Übrig:</b><br>
        <span id="weekRemaining">0</span> kcal
      </div>
    </div>
    <div style="margin-top:10px">
      <progress id="weekProgress" max="16100" value="0"></progress>
    </div>
  </section>

  <script>
    const STORAGE='calorie_entries_v1';
    const GOAL=2300;
    const WEEK_LIMIT=GOAL*7;
    const todayKey=new Date().toISOString().slice(0,10);
    document.getElementById('today').textContent=todayKey;
    document.getElementById('goal').textContent=GOAL;

    const food=document.getElementById('food');
    const cal=document.getElementById('cal');
    const meal=document.getElementById('meal');
    const tbody=document.querySelector('#list tbody');
    const sumEl=document.getElementById('sum');
    const progress=document.getElementById('progress');

    function load(){try{return JSON.parse(localStorage.getItem(STORAGE))||[]}catch{return[]}}
    function save(d){localStorage.setItem(STORAGE,JSON.stringify(d))}
    function add(){
      if(!food.value||!cal.value)return alert('Bitte Lebensmittel und Kalorien angeben.');
      const all=load();
      all.push({id:Date.now(),date:todayKey,food:food.value,meal:meal.value,cal:+cal.value});
      save(all);
      food.value='';cal.value='';
      render();
    }

    function startOfWeek(d){
      const day=d.getDay(); // So=0, Mo=1
      const diff=(day===0?6:day-1); // Montag als Wochenstart
      const monday=new Date(d);
      monday.setDate(d.getDate()-diff);
      monday.setHours(0,0,0,0);
      return monday;
    }

    function render(){
      const all=load();
      const today=all.filter(e=>e.date===todayKey);
      tbody.innerHTML='';
      let totalToday=0;
      for(const e of today){
        totalToday+=e.cal;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${e.food}</td><td>${e.meal}</td><td>${e.cal}</td>`;
        tbody.appendChild(tr);
      }
      sumEl.textContent=totalToday.toFixed(1);
      progress.value=totalToday;

      // Wochenberechnung
      const now=new Date();
      const monday=startOfWeek(now);
      const weekEntries=all.filter(e=>new Date(e.date)>=monday);
      const weekTotal=weekEntries.reduce((s,e)=>s+e.cal,0);
      const weekRemaining=Math.max(WEEK_LIMIT-weekTotal,0);

      document.getElementById('weekUsed').textContent=weekTotal.toFixed(1);
      document.getElementById('weekLimit').textContent=WEEK_LIMIT;
      document.getElementById('weekRemaining').textContent=weekRemaining.toFixed(1);
      const weekProg=document.getElementById('weekProgress');
      weekProg.max=WEEK_LIMIT;
      weekProg.value=weekTotal;
    }

    document.getElementById('add').onclick=add;
    render();
  </script>
</body>
</html>
