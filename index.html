<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalorienzähler</title>
<style>
  body { font-family: system-ui, Arial, sans-serif; background: #f0f4f8; margin:0; padding:20px;}
  h1,h2 { margin: 0 0 10px;}
  section { background: #fff; border-radius: 12px; padding:16px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  input, select, button { padding:8px; font-size:14px; border-radius:6px; border:1px solid #ccc;}
  input, select { width:100%; margin-bottom:8px;}
  button { background:#3b82f6; color:#fff; border:none; cursor:pointer; width:100%; padding:10px; margin-top:4px;}
  table { width:100%; border-collapse: collapse; margin-top:10px;}
  th, td { padding:8px; text-align:left; border-bottom:1px solid #ccc;}
  .progress { width:100%; height:20px; border-radius:10px; overflow:hidden; margin-top:6px;}
  progress::-webkit-progress-bar { background:#eee;}
  progress::-webkit-progress-value { background:#3b82f6;}
  @media(max-width:500px){section{padding:12px}}
</style>
  <link rel="icon" type="image/png" href="Logo.png">
  <link rel="apple-touch-icon" href="Logo.png">
</head>
<body>

<h1>Kalorienzähler</h1>

<section>
  <h2>Neuer Eintrag</h2>
  <input type="text" id="food" placeholder="Lebensmittel">
  <input type="number" id="cal" placeholder="Kalorien (kcal)" min="0">
  <select id="meal">
    <option>Frühstück</option>
    <option>Mittagessen</option>
    <option>Abendessen</option>
    <option>Snack</option>
  </select>
  <button id="add">Eintrag hinzufügen</button>
</section>

<section>
  <h2>Heute <span id="today"></span></h2>
  <table>
    <thead><tr><th>Lebensmittel</th><th>Mahlzeit</th><th>Kcal</th></tr></thead>
    <tbody id="list"></tbody>
  </table>
  <div>Tagesgesamt: <span id="sum">0</span> / 2600 kcal</div>
  <progress id="progress" max="2600" value="0"></progress>
</section>

<section>
  <h2>Woche</h2>
  <div>Bisher verbraucht: <span id="weekUsed">0</span> kcal</div>
  <div>Gesamt erlaubt: <span id="weekLimit">18200</span> kcal</div>
  <div>Übrig: <span id="weekRemaining">0</span> kcal</div>
  <progress id="weekProgress" max="18200" value="0"></progress>
</section>

<script>
const STORAGE = 'kalorie_entries';
const DAILY_GOAL = 2600;
const WEEK_LIMIT = DAILY_GOAL*7;

// Datum heute in CET
function getTodayCET(){
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset()*60000;
  const cet = new Date(utc + 3600000); // CET = UTC+1
  return cet.toISOString().slice(0,10);
}

let todayKey = getTodayCET();
document.getElementById('today').textContent = todayKey;

const food = document.getElementById('food');
const cal = document.getElementById('cal');
const meal = document.getElementById('meal');
const tbody = document.getElementById('list');
const sumEl = document.getElementById('sum');
const progress = document.getElementById('progress');
const weekUsed = document.getElementById('weekUsed');
const weekRemaining = document.getElementById('weekRemaining');
const weekProgress = document.getElementById('weekProgress');

function load(){ 
  try { return JSON.parse(localStorage.getItem(STORAGE))||[] } 
  catch{return[]}
}

function save(data){ localStorage.setItem(STORAGE, JSON.stringify(data)) }

function resetWeekIfNeeded(){
  const entries = load();
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset()*60000;
  const cet = new Date(utc + 3600000);
  const day = cet.getDay(); // So=0, Mo=1
  if(day===1 && cet.getHours()===0 && cet.getMinutes()===0){
    // Montag 00:00 CET -> reset week older als 7 Tage
    const filtered = entries.filter(e => new Date(e.date) >= new Date(cet.getTime()-6*24*60*60*1000));
    save(filtered);
  }
}

function addEntry(){
  if(!food.value || !cal.value) return alert("Bitte Lebensmittel und Kalorien angeben.");
  const entries = load();
  entries.push({id:Date.now(), date: todayKey, food: food.value, cal:+cal.value, meal: meal.value});
  save(entries);
  food.value=''; cal.value='';
  render();
}

function render(){
  resetWeekIfNeeded();
  const entries = load();
  const todayEntries = entries.filter(e=>e.date===todayKey);

  tbody.innerHTML='';
  let totalToday=0;
  for(const e of todayEntries){
    totalToday+=e.cal;
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${e.food}</td><td>${e.meal}</td><td>${e.cal}</td>`;
    tbody.appendChild(tr);
  }
  sumEl.textContent = totalToday;
  progress.value = totalToday;

  // Wochenübersicht
  const now = new Date();
  const monday = new Date(now);
  const day = monday.getDay();
  const diff = day===0?6:day-1;
  monday.setDate(now.getDate()-diff);
  monday.setHours(0,0,0,0);
  const weekEntries = entries.filter(e=>new Date(e.date)>=monday);
  const weekTotal = weekEntries.reduce((s,e)=>s+e.cal,0);
  weekUsed.textContent = weekTotal;
  weekRemaining.textContent = Math.max(WEEK_LIMIT-weekTotal,0);
  weekProgress.value = weekTotal;
  weekProgress.max = WEEK_LIMIT;
}

document.getElementById('add').onclick = addEntry;
render();

// optional: jeden Tag neu prüfen
setInterval(()=>{
  const today = getTodayCET();
  if(today !== todayKey){ todayKey=today; render(); }
},60000);

</script>
</body>
</html>

